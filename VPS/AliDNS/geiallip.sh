#!/bin/bash

DNS_SERVER="8.8.8.8"
# 目标域名
DOMAIN="example.com"
SUBNETS=(
    # CT
    111.180.138.0/24
    42.81.147.0/24
    61.134.71.0/24
    58.220.65.0/24
    14.17.91.0/24
    220.164.107.0/24
    222.212.211.0/24
    1.71.14.0/24
    115.223.49.0/24
    61.180.32.0/24
    125.77.130.0/24
    113.142.209.0/24
    49.119.121.0/24
    180.163.117.0/24
    111.124.75.0/24
    171.109.103.0/24
    1.194.195.0/24
    27.128.218.0/24
    49.79.232.0/24
    112.67.249.0/24
    61.147.112.0/24
    58.220.78.0/24
    121.12.173.0/24
    117.24.11.0/24
    36.103.166.0/24
    113.62.126.0/24
    115.223.12.0/24
    42.101.77.0/24
    113.219.132.0/24
    116.53.37.0/24

    # CU
    180.95.178.0/24
    211.91.233.0/24
    157.148.78.0/24
    116.153.79.0/24
    123.126.74.0/24
    211.91.76.0/24
    58.144.228.0/24
    218.24.85.0/24
    14.205.42.0/24
    116.196.129.0/24
    112.91.91.0/24
    211.95.52.0/24
    122.195.144.0/24
    60.221.236.0/24
    113.201.242.0/24
    58.144.228.0/24
    124.166.227.0/24
    111.164.19.0/24
    110.72.104.0/24
    220.202.155.0/24
    42.231.143.0/24
    211.95.37.0/24
    112.91.91.0/24
    101.28.249.0/24
    116.177.226.0/24
    14.205.46.0/24
    218.60.173.0/24
    218.24.86.0/24

    # CM
    111.2.112.0/24
    36.150.235.0/24
    111.51.133.0/24
    120.232.104.0/24
    183.232.10.0/24
    117.187.147.0/24
    183.201.84.0/24
    112.48.136.0/24
    111.27.123.0/24
    117.186.171.0/24
    183.214.22.0/24
    120.221.97.0/24
    111.132.35.0/24
    111.47.209.0/24
    117.187.46.0/24
    223.64.229.0/24
    112.57.78.0/24
    36.136.93.0/24
    183.255.112.0/24
    112.46.150.0/24
    111.132.38.0/24
    223.109.46.0/24
    221.180.210.0/24
    117.163.62.0/24
    111.6.13.0/24
    36.147.31.0/24
    36.147.69.0/24
    223.100.47.0/24
    117.187.214.0/24
    117.145.179.0/24
    117.180.226.0/24
)

TMP_FILE=$(mktemp)

for subnet in "${SUBNETS[@]}"; do
    dig @$DNS_SERVER $DOMAIN +short +subnet=$subnet >> "$TMP_FILE"
done

grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' "$TMP_FILE" | sort -u > ip.txt

rm -f "$TMP_FILE"